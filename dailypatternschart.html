<html>
<head>
</head>
<body>

    <script src="amcharts4/core.js"></script>
    <script src="amcharts4/charts.js"></script>
    <script src="amcharts4/themes/material.js"></script>

    <div id="chartdiv" style="width: 1000px; height: 400px;" align="center"></div>

    <script>
    
    am4core.useTheme(am4themes_material);

    function renderChart(apiData) {
        
        apiData = '{ "sensorTypes": ' + apiData + '}';
        
        //console.log('apiData: ' + apiData);

        var theData = JSON.parse(apiData);
          
        let start = new Date()
        start.setHours(0, 0, 0, 0)
        let end = new Date()
        end.setHours(23, 59, 59, 999)

   //     am4core.options.commercialLicense = true

   //     am4core.useTheme(am4themes_animated)
    //    am4core.useTheme(defaultTheme)

        let chartConfig = {
            fontSize: 11,
            xAxes: [
                {
                    type: 'DateAxis',
                    min: start.getTime(),
                    max: end.getTime(),
                    strictMinMax: true,
                    renderer: {
                        minGridDistance: 45
                    },
                    baseInterval: {
                        count: 1,
                        timeUnit: 'minute'
                    }
                }
            ],
            yAxes: [
                {
                    type: 'CategoryAxis',
                    dataFields: {
                        category: 'name'
                    },
                    renderer: {
                        minGridDistance: 20
                    }
                }
            ],
            series: [
                {
                    type: 'ColumnSeries',
                    dataFields: {
                        openDateX: 'start',
                        dateX: 'end',
                        categoryY: 'name'
                    },
                    columns: {
                        height: 20,
                        tooltipText: 'From: {openDateX.formatDate(\'hh:mm\')} To: {dateX.formatDate(\'hh:mm\')}'
                    }
                }
            ],
            scrollbarX: {
                startGrip: {
                    scale: 0.75
                },
                endGrip: {
                    scale: 0.75
                }
            },
            cursor: {
                type: 'XYCursor',
                behavior: 'zoomX'
            }
        }

        let chart = am4core.createFromConfig(chartConfig, "chartdiv", am4charts.XYChart)
        
        
        
        // update chart times
        start = new Date(this.props.query.date);
        start.setHours(0, 0, 0, 0)
        end = new Date(this.props.query.date);
        end.setHours(23, 59, 59, 999)

     //   console.log("UPDATING CHART AXES");
     //   console.log(this.chart.xAxes);
        chart.xAxes.getIndex(0).min = start.getTime();
        chart.xAxes.getIndex(0).max = end.getTime();


        let groups = []  //props.services props.sensorData
        let items = []

   //     if (this.props.discreteData.services) {
   //         this.props.discreteData.services.forEach(srv => {
   //             if (srv.enabled) {

        for (i = 0; i < theData.sensorTypes.length; i++) { 
   //                 this.props.discreteData.sensorData.data.forEach(sd => {
            

   //                     if (sd.id == srv.id) {
   //                         sd.devices.forEach(d => {
            for (j = 0; j < theData.sensorTypes[i].devices.length; j++) { 
   //                             d.data.forEach(data => {
                
                  var d = theData.sensorTypes[i].devices[j].data[k];

                
                                    items.push({
                                        start: d.start * 1000,
                                        end: d.end * 1000,
                                        gp: theData.sensorTypes[i].devices[j].id + '_' + theData.sensorTypes[i].id,
                                        name: theData.sensorTypes[i].devices[j].name
                                    })
                                })
                            })
                        }
                    })
   //             }
   //        })
   //     }
        chart.data = items;
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        
/*
        var chartData = [];
        var c = 0;
        
        for (i = 0; i < theData.sensorTypes.length; i++) { 
            
            for (j = 0; j < theData.sensorTypes[i].devices.length; j++) { 
            
                var deviceName = theData.sensorTypes[i].devices[j].name;
                
                var b = 0.00;     
                
                for (k = 0; k < theData.sensorTypes[i].devices[j].data.length; k++) { 
                
                    var d = theData.sensorTypes[i].devices[j].data[k];
                    
                    var start = new Date(d.start*1000).toISOString();
                    var end = new Date(d.end*1000).toISOString();
                    
                  // console.log('{name: ' + deviceName + ', fromDate: ' + start + ', toDate: ' + end + ', color: ' + colorSet.getIndex(c).brighten(b) + '}');

                    chartData.push({
                            "name": deviceName,
                            "fromDate": start,
                            "toDate": end,
                            "color": colorSet.getIndex(c).brighten(b)
                    });
                    
                     b+=0.02;
                }
                
                 c++;
            }
        }
*/
        

    }
            
    </script>

</body>
</html>
